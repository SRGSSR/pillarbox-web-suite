import babel from '@rollup/plugin-babel';
import commonjs from '@rollup/plugin-commonjs';
import filesize from 'rollup-plugin-filesize';
import json from '@rollup/plugin-json';
import resolve from '@rollup/plugin-node-resolve';
import terser from '@rollup/plugin-terser';

/**
 * Rollup build configurations for the Skip button Plugin.
 */
export default [
  /**
   * Rollup build configuration for the ESModule build.
   *
   * Outputs:
   * - 'dist/{{kebabCase name}}.es.min.js': Minified ESModule version with sourcemaps.
   * - 'dist/{{kebabCase name}}.es.js': Non-minified ESModule.
   *
   * @example
   * ```javascript
   * import '@srgssr/{{kebabCase name}}'
   * ```
   */
  {
    input: 'src/{{kebabCase name}}.js',
    output: [
      {
        file: 'dist/{{kebabCase name}}.es.min.js',
        format: 'es',
        sourcemap: true,
        plugins: [terser()],
      },
      {
        file: 'dist/{{kebabCase name}}.es.js',
        format: 'es',
        plugins: [filesize()]
      }
    ],
    external: ['@srgssr/pillarbox-web'],
    plugins: [json(), resolve(), babel({
      babelHelpers: 'bundled',
      exclude: 'node_modules/**'
    })]
  },
  /**
   * Rollup build configuration for the CJS build.
   *
   * Outputs:
   * - 'dist/{{kebabCase name}}.cjs.min.js': Minified UMD version with sourcemaps.
   * - 'dist/{{kebabCase name}}.cjs.js': Non-minified UMD.
   *
   * @example
   * ```html
   * <script src="{{kebabCase name}}.cjs.min.js"></script>
   * ```
   *
   * @type {import('rollup').RollupOptions}
   */
  {
    input: 'src/{{kebabCase name}}.js',
    output: [
      {
        name: '{{properCase name}}',
        file: 'dist/{{kebabCase name}}.cjs.min.js',
        format: 'cjs',
        sourcemap: true,
        globals: {
          '@srgssr/pillarbox-web': 'pillarbox'
        },
        plugins: [terser()]
      },
      {
        name: '{{properCase name}}',
        file: 'dist/{{kebabCase name}}.cjs.js',
        format: 'cjs',
        globals: {
          '@srgssr/pillarbox-web': 'pillarbox'
        },
        plugins: [filesize()]
      }
    ],
    external: ['@srgssr/pillarbox-web'],
    plugins: [commonjs(), json(), resolve(), babel({
      babelHelpers: 'bundled',
      exclude: 'node_modules/**'
    })]
  }
];
